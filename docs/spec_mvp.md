# アルバムアプリ MVP 仕様書

## 概要

写真をたくさん撮るが整理が苦手なユーザーのための、「見返す楽しさ」を軸にしたデスクトップアルバムアプリ。
膨大な写真の中から気になるイベント（日）だけを開いてベストショットを選び、お気に入りだけをスライドショーで楽しめる。

## 技術スタック

- **Electron**（デスクトップアプリ）
- **React + TypeScript**（フロントエンド）
- **Node.js**（バックエンド / メインプロセス）
- **SQLite**（メタデータ永続化：better-sqlite3）
- **EXIF読み取り**：exifr または exif-reader
- **ビルド**：electron-builder で Windows 向け .exe / インストーラーを生成
- 開発環境：Windows

## ユーザーフロー

```
フォルダ指定
  ↓
写真スキャン（EXIF日付を読み取り）
  ↓
イベント一覧（日付でグルーピング）
  ↓
イベントを選択 → 写真一覧（グリッド）
  ↓
ベストマークをつける（ワンタップ）
  ↓
スライドショー（ベストだけ再生）
```

## 画面構成

### 1. フォルダ選択画面（初回 / 設定）

- 「フォルダを選択」ボタン → OSのフォルダ選択ダイアログ
- 選択後、スキャンが始まり進捗を表示
- 再起動時は前回のフォルダを記憶

### 2. イベント一覧画面（メイン）

- 日付単位でグルーピングされたイベントが縦スクロールで並ぶ
- 各イベントの表示内容：
  - 日付（例：2024年8月15日）
  - 写真枚数
  - 代表サムネイル（先頭の写真、または将来的にはランダム）
- **表示ルール**：
  - 写真が3枚以上の日を「イベント」として目立たせる
  - 写真が1〜2枚の日は小さく / 控えめに表示（消さない）
  - **連続するイベント日は視覚的にまとめる**：日付間の余白を詰め、同じ背景色やサイドラインで繋ぐことで「一連の旅行」感を出す
- スライドショーボタン（全ベストショットを対象）

### 3. イベント詳細画面（写真グリッド）

- 選択したイベント（日）の写真をグリッド表示
- 写真をクリック → 拡大表示（ライトボックス的なモーダル）
- 各写真にベストマーク（★ or ♥）をワンタップで付け外しできる
  - グリッド上のサムネイルにオーバーレイ表示
  - 拡大表示中にも操作可能
- イベント単位のスライドショーボタン（そのイベントのベストだけ再生）

### 4. スライドショー画面

- フルスクリーン（またはフルウィンドウ）で写真を順次表示
- 対象：ベストマークがついた写真のみ
- スコープ：
  - 全イベント横断（イベント一覧から起動）
  - 特定イベント内（イベント詳細から起動）
- 表示順：ランダム
- 表示間隔：5秒程度（将来的に調整可能にしてもよい）
- 操作：クリックまたはESCで終了、左右キーで手動送り

## データモデル

### SQLiteテーブル

```sql
-- スキャン対象フォルダ
CREATE TABLE folders (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  path TEXT NOT NULL UNIQUE,
  last_scanned_at TEXT
);

-- 写真メタデータ
CREATE TABLE photos (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  folder_id INTEGER NOT NULL,
  file_path TEXT NOT NULL UNIQUE,
  file_name TEXT NOT NULL,
  taken_at TEXT,          -- EXIF撮影日時（ISO8601）
  file_modified_at TEXT,  -- EXIFがない場合のフォールバック
  width INTEGER,
  height INTEGER,
  is_best BOOLEAN DEFAULT 0,  -- ベストマーク
  created_at TEXT DEFAULT (datetime('now')),
  FOREIGN KEY (folder_id) REFERENCES folders(id)
);

-- インデックス
CREATE INDEX idx_photos_taken_at ON photos(taken_at);
CREATE INDEX idx_photos_is_best ON photos(is_best);
```

## 写真スキャンのロジック

- 指定フォルダを再帰的に走査
- 対象拡張子：`.jpg`, `.jpeg`, `.png`, `.heic`, `.webp`
  - MVP段階では動画（.mp4等）は対象外
- 各ファイルからEXIF情報を読み取り：
  - `DateTimeOriginal` を `taken_at` に使用
  - EXIFがない場合は `file_modified_at` をフォールバックとして使用
- 既にDBに登録済みのファイルはスキップ（file_pathで判定）
- スキャンは非同期で行い、UIをブロックしない

## イベントグルーピングのロジック

- `taken_at`（またはフォールバック日時）の日付部分でグルーピング
- 写真枚数で表示を分ける：
  - 3枚以上：通常のイベントカード（大きめ表示）
  - 1〜2枚：コンパクト表示
- 連続日の検出：
  - 3枚以上の「イベント日」が連続している場合（間に空白日がない、または1日だけの空白）、視覚的にグループ化する
  - 具体的なUI処理：カード間のマージンを縮小し、左サイドに連続を示すラインや背景色を入れる

## サムネイル生成

- パフォーマンスのため、スキャン時にサムネイルを生成してキャッシュ
- `sharp` ライブラリを使用
- サイズ：300px（長辺）程度
- 保存先：アプリのユーザーデータディレクトリ内に `thumbnails/` フォルダ
- ファイル名：元ファイルパスのハッシュ値 + `.jpg`

## 非機能要件

- 写真が数千〜数万枚でも動作すること（仮想スクロール等を検討）
- スキャン中もUIが操作可能であること
- アプリ終了後もベストマーク等のデータが永続化されること

## MVPから除外する機能（将来対応）

- 動画の表示・再生
- 重複 / 類似写真の検出
- 撮影場所の推定 / 表示
- 人物認識・グルーピング
- タグ付け（「HG」「犬」等のカスタムタグ）
- イベントの手動結合 / 分割
- テーマ別スライドショーフィルタ（ベスト以外）
- スライドショーの表示間隔・トランジション設定